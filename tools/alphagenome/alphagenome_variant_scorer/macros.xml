<macros>
    <!-- Version information -->
    <token name="@TOOL_VERSION@">1.0.0</token>
    <token name="@PROFILE@">21.05</token>
    
    <!-- Package versions -->
    <token name="@PYTHON_VERSION@">3.9</token>
    <token name="@PYSAM_VERSION@">0.22.0</token>
    <token name="@CYVCF2_VERSION@">0.30.24</token>
    <token name="@REQUESTS_VERSION@">2.31.0</token>
    <token name="@URLLIB3_VERSION@">1.26.18</token>
    
    <!-- Environment setup -->
    <token name="@SETUP_ENVIRONMENT@"><![CDATA[
        export PYTHONPATH="\$PYTHONPATH:$__tool_directory__/../../../shared" &&
        export ALPHAGENOME_CACHE_DIR="\$__job_directory__/alphagenome_cache" &&
        mkdir -p "\$ALPHAGENOME_CACHE_DIR" &&
    ]]></token>
    
    <!-- Common citations -->
    <xml name="citations">
        <citations>
            <citation type="doi">10.1038/s41586-2025-alphagenome</citation>
        </citations>
    </xml>
    
    <!-- Common help sections -->
    <xml name="api_help">
        <help><![CDATA[
**AlphaGenome API Configuration**

To use this tool, you need an AlphaGenome API key:

1. Visit https://deepmind.google.com/science/alphagenome
2. Request API access (requires registration)
3. Copy your API key to use in Galaxy

**Important**: Keep your API key secure and never share it publicly.
        ]]></help>
    </xml>
    
    <xml name="usage_notes">
        <help><![CDATA[
**Usage Notes**

• **Non-commercial use only** - AlphaGenome is for research purposes
• **Rate limits apply** - API has usage quotas to ensure fair access
• **Internet required** - Tool needs network access to AlphaGenome API
• **Caching enabled** - Results are cached to minimize redundant API calls
        ]]></help>
    </xml>
    
    <!-- Common parameter sets -->
    <xml name="prediction_types">
        <param name="predictions" type="select" multiple="true" display="checkboxes" 
               label="Select prediction types">
            <option value="expression" selected="true">Gene expression impact</option>
            <option value="splicing" selected="true">Splicing disruption</option>
            <option value="chromatin" selected="false">Chromatin accessibility</option>
            <option value="conservation" selected="false">Conservation scores</option>
            <validator type="no_options" message="At least one prediction type must be selected"/>
        </param>
    </xml>
    
    <xml name="processing_params">
        <param name="max_variants" type="integer" value="1000" min="1" max="10000"
               label="Maximum variants to process" 
               help="API usage limits require capping the number of variants"/>
        
        <param name="window_size" type="integer" value="1000" min="200" max="5000"
               label="Sequence context window size (bp)" 
               help="Size of genomic sequence around variant for prediction context"/>
        
        <param name="batch_size" type="integer" value="50" min="1" max="100"
               label="API batch size"
               help="Number of variants per API request batch"/>
    </xml>
    
    <xml name="reference_genome_conditional">
        <conditional name="reference">
            <param name="ref_source" type="select" label="Reference genome source">
                <option value="builtin" selected="true">Use built-in reference genome</option>
                <option value="history">Use reference genome from history</option>
            </param>
            <when value="builtin">
                <param name="builtin" type="select" label="Select reference genome">
                    <options from_data_table="all_fasta">
                        <filter type="sort_by" column="2"/>
                        <validator type="no_options" message="No reference genomes available"/>
                    </options>
                </param>
            </when>
            <when value="history">
                <param name="reference_genome" type="data" format="fasta,fasta.gz" 
                       label="Reference genome (FASTA)"/>
            </when>
        </conditional>
    </xml>
    
    <!-- Common validators -->
    <xml name="api_key_validator">
        <validator type="empty_field" message="API key is required"/>
        <validator type="length" min="10" message="API key appears to be too short"/>
    </xml>
    
    <!-- Common command line components -->
    <token name="@REFERENCE_COMMAND@"><![CDATA[
        #if $reference.ref_source == "history"
            --reference '$reference.reference_genome'
        #else
            --reference '$reference.builtin.fields.path'
        #end if
    ]]></token>
    
    <token name="@PREDICTIONS_COMMAND@"><![CDATA[
        --predictions
        #for $pred in $predictions
            '$pred'
        #end for
    ]]></token>
    
    <!-- Data table configurations -->
    <xml name="fasta_data_table">
        <table name="fasta_indexes" comment_char="#" allow_duplicate_entries="False">
            <columns>value, dbkey, name, path</columns>
            <file path="tool-data/fasta_indexes.loc"/>
        </table>
    </xml>
</macros>